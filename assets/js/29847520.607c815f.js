"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[2253],{41778:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>c,toc:()=>t});var i=r(75366),s=r(26192);const d={},l="WireGuard",c={id:"Network/WireGuard",title:"WireGuard",description:"Ref: Quick Start",source:"@site/docs/Network/WireGuard.md",sourceDirName:"Network",slug:"/Network/WireGuard",permalink:"/note/Network/WireGuard",draft:!1,unlisted:!1,editUrl:"https://github.com/steelywing/note/edit/master/docs/Network/WireGuard.md",tags:[],version:"current",frontMatter:{},sidebar:"network",previous:{title:"Static Key",permalink:"/note/Network/OpenVPN/Static Key"}},a={},t=[{value:"Key Generation",id:"key-generation",level:2},{value:"CLI",id:"cli",level:2},{value:"Config",id:"config",level:2},{value:"Method 1",id:"method-1",level:3},{value:"Method 2",id:"method-2",level:3},{value:"Route to WireGuard interface",id:"route-to-wireguard-interface",level:2},{value:"Show status",id:"show-status",level:2},{value:"Show config",id:"show-config",level:2},{value:"<code>wg-quick</code>",id:"wg-quick",level:2},{value:"OpenWRT",id:"openwrt",level:2}];function o(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"wireguard",children:"WireGuard"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Ref: ",(0,i.jsx)(n.a,{href:"https://www.wireguard.com/quickstart/",children:"Quick Start"})]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Ref: ",(0,i.jsx)(n.a,{href:"https://www.wireguard.com/papers/wireguard.pdf",children:"White Paper"})," / ",(0,i.jsx)(n.a,{href:"./wireguard.pdf",children:"Download"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"key-generation",children:"Key Generation"}),"\n",(0,i.jsx)(n.p,{children:"Private Key"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"umask 077\nwg genkey > private-key\n"})}),"\n",(0,i.jsx)(n.p,{children:"Public Key"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"wg pubkey < private-key > public-key\n"})}),"\n",(0,i.jsx)(n.p,{children:"Private and Public Key"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"wg genkey | tee private-key | wg pubkey > public-key\n"})}),"\n",(0,i.jsx)(n.h2,{id:"cli",children:"CLI"}),"\n",(0,i.jsx)(n.p,{children:"Peer A"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Public IP ",(0,i.jsx)(n.code,{children:"1.1.1.1"})]}),"\n",(0,i.jsxs)(n.li,{children:["LAN ",(0,i.jsx)(n.code,{children:"10.0.1.0/24"})]}),"\n",(0,i.jsxs)(n.li,{children:["UDP port ",(0,i.jsx)(n.code,{children:"10100"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Peer B"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Public IP: ",(0,i.jsx)(n.code,{children:"2.2.2.2"})]}),"\n",(0,i.jsxs)(n.li,{children:["LAN: ",(0,i.jsx)(n.code,{children:"10.0.2.0/24"})]}),"\n",(0,i.jsxs)(n.li,{children:["UDP port ",(0,i.jsx)(n.code,{children:"random"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ip link add dev wg0 type wireguard\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",metastring:'title="Peer A"',children:"ip address add dev wg0 10.0.0.1/24\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",metastring:'title="Peer B"',children:"ip address add dev wg0 10.0.0.2/24\n"})}),"\n",(0,i.jsx)(n.p,{children:"If there are only 2 peers, peer to peer also works"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ip address add dev wg0 10.0.0.1 peer 10.0.0.2\n"})}),"\n",(0,i.jsx)(n.h2,{id:"config",children:"Config"}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"AllowedIPs"})," can overlap"]}),"\n",(0,i.jsxs)(n.li,{children:["WireGuard use ",(0,i.jsx)(n.code,{children:"AllowedIPs"})," to choose peer"]}),"\n",(0,i.jsxs)(n.li,{children:["Set ",(0,i.jsx)(n.code,{children:"Endpoint"})," to the peer to initiate the connection"]}),"\n"]})}),"\n",(0,i.jsx)(n.h3,{id:"method-1",children:"Method 1"}),"\n",(0,i.jsx)(n.p,{children:"Use config file"}),"\n",(0,i.jsx)(n.p,{children:"Peer A"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",children:"[Interface]\nAddress = 192.168.0.1/24\nPrivateKey = 4IMHVUu9Ug0oujxxWdOiZXMQ74Sq5gag5ND6cbaIQX4=\nListenPort = 10100\n\n[Peer]\nPublicKey = /QgJoWF3KA2K5CHPfIc/T0KhXKuFe1k5V75mQuK5vEo=\nAllowedIPs = 192.168.0.2/32, 10.0.2.0/24\n"})}),"\n",(0,i.jsx)(n.p,{children:"Peer B"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",children:"[Interface]\nAddress = 192.168.0.2/24\n# DNS = 192.168.0.2, fd00::1\nPrivateKey = AM/sFBkkiMGL4iGUMV1RO+cVmeaHcE5uGg/xxUoDsH0=\n\n[Peer]\nPublicKey = cWlZ8WRv4D0bGACuHwXGfmudZeMsFDYiVSmjPlVc0ko=\nAllowedIPs = 192.168.0.1/32, 10.0.1.0/24\nEndpoint = 1.1.1.1:10100\n\n# for routing all traffic to Peer A\n# AllowedIPs = 0.0.0.0/0\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"wg setconf wg0 wg0.conf\n"})}),"\n",(0,i.jsx)(n.h3,{id:"method-2",children:"Method 2"}),"\n",(0,i.jsx)(n.p,{children:"Use CLI parameters"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Peer A\nwg set wg0 listen-port 10100 private-key "/path/to/private-key" peer "<peer B public key>" allowed-ips "192.168.0.2/32,10.0.2.0/24"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Peer B\nwg set wg0 listen-port 10100 private-key "/path/to/private-key" peer "<peer A public key>" allowed-ips "192.168.0.1/32,10.0.1.0/24" endpoint "1.1.1.1:10100"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ip link set up dev wg0\n"})}),"\n",(0,i.jsx)(n.h2,{id:"route-to-wireguard-interface",children:"Route to WireGuard interface"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"AllowedIPs"})," will auto create route, don't need to manually add route"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"ip route add <subnet>/<mask> dev wg0\n"})}),"\n",(0,i.jsx)(n.p,{children:"Peer A"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"ip route add 10.0.2.0/24 dev wg0\n"})}),"\n",(0,i.jsx)(n.p,{children:"Peer B"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"ip route add 10.0.1.0/24 dev wg0\n"})}),"\n",(0,i.jsx)(n.h2,{id:"show-status",children:"Show status"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"wg\n"})}),"\n",(0,i.jsx)(n.h2,{id:"show-config",children:"Show config"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"wg showconf\n"})}),"\n",(0,i.jsx)(n.h2,{id:"wg-quick",children:(0,i.jsx)(n.code,{children:"wg-quick"})}),"\n",(0,i.jsxs)(n.p,{children:["Setup interface using config in ",(0,i.jsx)(n.code,{children:"/etc/wireguard/"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Use /etc/wireguard/wgnet0.conf\nwg-quick up wgnet0\n"})}),"\n",(0,i.jsx)(n.p,{children:"or"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"wg-quick up /path/to/wgnet0.conf\n"})}),"\n",(0,i.jsx)(n.h2,{id:"openwrt",children:"OpenWRT"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"opkg install luci-app-wireguard\n/etc/init.d/network restart\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},26192:(e,n,r)=>{r.d(n,{Z:()=>c,a:()=>l});var i=r(97049);const s={},d=i.createContext(s);function l(e){const n=i.useContext(d);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(d.Provider,{value:n},e.children)}}}]);