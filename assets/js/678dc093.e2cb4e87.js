"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[2890],{28329:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>o,contentTitle:()=>r,default:()=>d,frontMatter:()=>a,metadata:()=>c,toc:()=>l});var s=t(75366),i=t(26192);const a={date:new Date("2024-03-10T00:00:00.000Z"),tags:["Nginx","FastCGI","PHP"],sidebar_label:"PHP FastCGI"},r="PHP FastCGI - Nginx",c={id:"Note/Nginx/FastCGI",title:"PHP FastCGI - Nginx",description:"Setting for pass request to PHP-FPM (FastCGI Process Manager)",source:"@site/docs/Note/Nginx/FastCGI.md",sourceDirName:"Note/Nginx",slug:"/Note/Nginx/FastCGI",permalink:"/note/Note/Nginx/FastCGI",draft:!1,unlisted:!1,editUrl:"https://github.com/steelywing/note/edit/master/docs/Note/Nginx/FastCGI.md",tags:[{label:"Nginx",permalink:"/note/tags/nginx"},{label:"FastCGI",permalink:"/note/tags/fast-cgi"},{label:"PHP",permalink:"/note/tags/php"}],version:"current",frontMatter:{date:"2024-03-10T00:00:00.000Z",tags:["Nginx","FastCGI","PHP"],sidebar_label:"PHP FastCGI"},sidebar:"note",previous:{title:"Debug",permalink:"/note/Note/Nginx/Debug"},next:{title:"Install - Nginx",permalink:"/note/Note/Nginx/Install"}},o={},l=[{value:"Run PHP-FPM",id:"run-php-fpm",level:2},{value:"Nginx config",id:"nginx-config",level:2},{value:"<code>PATH_INFO</code>",id:"path_info",level:2},{value:"Send all requests to a single PHP file",id:"send-all-requests-to-a-single-php-file",level:2},{value:"Note",id:"note",level:2}];function p(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h1,{id:"php-fastcgi---nginx",children:"PHP FastCGI - Nginx"}),"\n",(0,s.jsx)(e.p,{children:"Setting for pass request to PHP-FPM (FastCGI Process Manager)"}),"\n",(0,s.jsx)(e.h2,{id:"run-php-fpm",children:"Run PHP-FPM"}),"\n",(0,s.jsx)(e.p,{children:"On Windows, start PHP-FPM with"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"php-cgi.exe -b 127.0.0.1:9000\n"})}),"\n",(0,s.jsxs)(e.p,{children:["On Linux, use ",(0,s.jsx)(e.code,{children:"php-fpm"})," service"]}),"\n",(0,s.jsx)(e.h2,{id:"nginx-config",children:"Nginx config"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-nginx",children:'http {\n    server {\n        root "/var/www/html";\n\n        location / {\n            index index.php index.html index.htm;\n        }\n\n        location ~* \\.php$ {\n            # check if PHP file exists\n            try_files $fastcgi_script_name =404;\n\n            # when PHP-FPM listen on Unix socket\n            fastcgi_pass    unix:/var/run/php-fpm.sock;\n\n            # when PHP-FPM listen on TCP\n            fastcgi_pass    127.0.0.1:9000;\n\n            fastcgi_param   SCRIPT_FILENAME     $document_root$fastcgi_script_name;\n            include         fastcgi_params;\n        }\n    }\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:["File ",(0,s.jsx)(e.code,{children:"fastcgi_params"})," is exist by default in Nginx"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-nginx",metastring:'title="fastcgi_params"',children:"fastcgi_param  QUERY_STRING       $query_string;\nfastcgi_param  REQUEST_METHOD     $request_method;\nfastcgi_param  CONTENT_TYPE       $content_type;\nfastcgi_param  CONTENT_LENGTH     $content_length;\n\nfastcgi_param  SCRIPT_NAME        $fastcgi_script_name;\nfastcgi_param  REQUEST_URI        $request_uri;\nfastcgi_param  DOCUMENT_URI       $document_uri;\nfastcgi_param  DOCUMENT_ROOT      $document_root;\nfastcgi_param  SERVER_PROTOCOL    $server_protocol;\nfastcgi_param  REQUEST_SCHEME     $scheme;\nfastcgi_param  HTTPS              $https if_not_empty;\n\nfastcgi_param  GATEWAY_INTERFACE  CGI/1.1;\nfastcgi_param  SERVER_SOFTWARE    nginx/$nginx_version;\n\nfastcgi_param  REMOTE_ADDR        $remote_addr;\nfastcgi_param  REMOTE_PORT        $remote_port;\nfastcgi_param  SERVER_ADDR        $server_addr;\nfastcgi_param  SERVER_PORT        $server_port;\nfastcgi_param  SERVER_NAME        $server_name;\n\n# PHP only, required if PHP was built with --enable-force-cgi-redirect\nfastcgi_param  REDIRECT_STATUS    200;\n"})}),"\n",(0,s.jsx)(e.h2,{id:"path_info",children:(0,s.jsx)(e.code,{children:"PATH_INFO"})}),"\n",(0,s.jsxs)(e.p,{children:["To support URI like ",(0,s.jsx)(e.code,{children:"/index.php/data"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-nginx",children:"server {\n    location ~* \\.php(/|$) {\n        fastcgi_pass    127.0.0.1:9000;\n\n        fastcgi_split_path_info ^(.+\\.php)(/.*)$;\n        fastcgi_param   SCRIPT_FILENAME $document_root$fastcgi_script_name;\n        # NOTE: most PHP frameworks does not need PATH_INFO\n        fastcgi_param   PATH_INFO   $fastcgi_path_info;\n\n        include fastcgi_params;\n    }\n}\n"})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsxs)(e.p,{children:["Ref: ",(0,s.jsx)(e.a,{href:"https://nginx.org/en/docs/http/ngx_http_fastcgi_module.html#fastcgi_split_path_info",children:(0,s.jsx)(e.code,{children:"fastcgi_split_path_info"})})]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"send-all-requests-to-a-single-php-file",children:"Send all requests to a single PHP file"}),"\n",(0,s.jsx)(e.p,{children:"Most PHP frameworks process requests from a single entry PHP file"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-nginx",children:"server {\n    location / {\n        # pass all requests to index.php if the URI file does not exist\n        try_files $uri /index.php$is_args$args;\n    }\n\n    location ~* \\.php$ {\n        # deny direct access PHP files\n        internal;\n\n        try_files $fastcgi_script_name =404;\n\n        fastcgi_pass    127.0.0.1:9000;\n        fastcgi_param   SCRIPT_FILENAME $document_root$fastcgi_script_name;\n\n        include fastcgi_params;\n    }\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"note",children:"Note"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsxs)(e.p,{children:["Ref: ",(0,s.jsxs)(e.a,{href:"https://nginx.org/en/docs/http/ngx_http_fastcgi_module.html#variables",children:["Embedded Variables - Module ",(0,s.jsx)(e.code,{children:"ngx_http_fastcgi_module"})]})]}),"\n"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"$fastcgi_script_name = $uri"})}),"\n",(0,s.jsxs)(e.li,{children:["if ",(0,s.jsx)(e.code,{children:"$fastcgi_script_name"})," end with ",(0,s.jsx)(e.code,{children:"/"}),", value of ",(0,s.jsx)(e.code,{children:"fastcgi_index"})," will be appended to ",(0,s.jsx)(e.code,{children:"$fastcgi_script_name"})]}),"\n"]})]})}function d(n={}){const{wrapper:e}={...(0,i.a)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(p,{...n})}):p(n)}},26192:(n,e,t)=>{t.d(e,{Z:()=>c,a:()=>r});var s=t(97049);const i={},a=s.createContext(i);function r(n){const e=s.useContext(a);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),s.createElement(a.Provider,{value:e},n.children)}}}]);