"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[1342],{95628:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>t});var r=s(75366),i=s(26192);const l={sidebar_label:"ACL"},d="ACL - Linux",c={id:"Linux/ACL",title:"ACL - Linux",description:"Access Control List",source:"@site/docs/Linux/ACL.md",sourceDirName:"Linux",slug:"/Linux/ACL",permalink:"/note/Linux/ACL",draft:!1,unlisted:!1,editUrl:"https://github.com/steelywing/note/edit/master/docs/Linux/ACL.md",tags:[],version:"current",frontMatter:{sidebar_label:"ACL"},sidebar:"linux",previous:{title:"Linux",permalink:"/note/Linux/"},next:{title:"Auto start",permalink:"/note/Linux/Auto start"}},a={},t=[{value:"ACL order",id:"acl-order",level:2},{value:"Group ACL entry",id:"group-acl-entry",level:2},{value:"Example",id:"example",level:2},{value:"Mask",id:"mask",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"acl---linux",children:"ACL - Linux"}),"\n",(0,r.jsx)(n.p,{children:"Access Control List"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Directory has ",(0,r.jsx)(n.code,{children:"default"})," ACL, ",(0,r.jsx)(n.code,{children:"default"})," ACL is applied to the file and directory created in that directory"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"default"})," \u5141\u8a31\u70ba\u76ee\u9304\u8a2d\u5b9a\u9810\u8a2d\u7684 ACL \u6b0a\u9650\u3002\u7576\u4e00\u500b\u76ee\u9304\u8a2d\u5b9a\u4e86 ",(0,r.jsx)(n.code,{children:"default"})," ACL \u5f8c\uff0c\u65b0\u5efa\u7684\u6a94\u6848\u548c\u5b50\u76ee\u9304\u6703\u7e7c\u627f\u8a72\u76ee\u9304\u7684 ",(0,r.jsx)(n.code,{children:"default"})," ACL"]}),"\n",(0,r.jsxs)(n.li,{children:["Only ",(0,r.jsx)(n.strong,{children:"root"})," can set owner / group, owner cannot set the owner of file / directory"]}),"\n",(0,r.jsxs)(n.li,{children:["Only ",(0,r.jsx)(n.strong,{children:"owner"})," / ",(0,r.jsx)(n.strong,{children:"root"})," can change permission, user in group cannot change permission"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"acl-order",children:"ACL order"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Ref: ",(0,r.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:s(59622).Z+"",children:"POSIX Access Control Lists on Linux"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"First matched"})," entry is used"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"owner"}),"\n",(0,r.jsx)(n.li,{children:"named users"}),"\n",(0,r.jsx)(n.li,{children:"(owning or named) groups"}),"\n",(0,r.jsx)(n.li,{children:"others"}),"\n"]}),"\n",(0,r.jsx)(n.mermaid,{value:'flowchart TD\n    matched["use matched \\n ACL entry"]\n    owner{{"match \\n owner?"}}\n    named_users{{"match \\n named users?"}}\n    groups{{"match \\n any (owning or named) groups?"}}\n    any_group{{"is any matched ACL entry \\n that has granted required permission?"}}\n    others["use `others` ACL entry"]\n    allow["allow"]\n    deny["deny"]\n    owner --Y--\x3e matched\n    owner --N--\x3e named_users\n    named_users --Y--\x3e matched\n    named_users --N--\x3e groups\n    groups --Y--\x3e any_group\n    any_group --Y--\x3e allow\n    any_group --N--\x3e deny\n    groups --N--\x3e others'}),"\n",(0,r.jsx)(n.h2,{id:"group-acl-entry",children:"Group ACL entry"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Group entry is not using the first matched, each matched group entry is checked"}),"\n",(0,r.jsx)(n.li,{children:"If any matched group entry is allow, the request is allow."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"admin"})," is in groups ",(0,r.jsx)(n.code,{children:"admin"})," and ",(0,r.jsx)(n.code,{children:"user"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"id admin\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"uid=1000(admin) gid=1000(admin) groups=1000(admin),1001(user)\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"user"})," is in group ",(0,r.jsx)(n.code,{children:"user"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"id user\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"uid=1001(user) gid=1001(user) groups=1001(user)\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"getfacl file\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"# file: file\n# owner: root\n# group: root\nuser::rw-\ngroup::r--\ngroup:user:---\ngroup:admin:r--\nmask::r--\nother::---\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"getfacl first\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"# file: first\n# owner: root\n# group: root\nuser::rw-\ngroup::r--\nuser:admin:---\ngroup:user:---\ngroup:admin:r--\nmask::r--\nother::---\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"User"}),(0,r.jsx)(n.th,{children:(0,r.jsx)(n.code,{children:"cat file"})}),(0,r.jsx)(n.th,{children:(0,r.jsx)(n.code,{children:"cat first"})})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"admin"})}),(0,r.jsx)(n.td,{children:"allow"}),(0,r.jsx)(n.td,{children:"deny"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"user"})}),(0,r.jsx)(n.td,{children:"deny"}),(0,r.jsx)(n.td,{children:"deny"})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"admin"})," read ",(0,r.jsx)(n.code,{children:"file"})," is allow"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"getfacl file\n...\ngroup:user:---\ngroup:admin:r--\nmask::r--\n"})}),"\n",(0,r.jsxs)(n.p,{children:["user ",(0,r.jsx)(n.code,{children:"admin"})," is allow to access ",(0,r.jsx)(n.code,{children:"file"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"allow access if any group of the process is granted permission"}),"\n",(0,r.jsxs)(n.li,{children:["even group ",(0,r.jsx)(n.code,{children:"user"})," is deny"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"admin"})," read ",(0,r.jsx)(n.code,{children:"first"})," is deny"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"getfacl first\n...\nuser:admin:---\ngroup:user:---\ngroup:admin:r--\nmask::r--\n"})}),"\n",(0,r.jsxs)(n.p,{children:["user ",(0,r.jsx)(n.code,{children:"admin"})," is deny to access ",(0,r.jsx)(n.code,{children:"first"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"first matched named user ACL is used"}),"\n",(0,r.jsxs)(n.li,{children:["even group ",(0,r.jsx)(n.code,{children:"admin"})," is allow access"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"mask",children:"Mask"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Ref: ",(0,r.jsx)(n.a,{href:"https://linuxdatahub.com/masks-in-acl-linux-explained-with-examples-access-control-lists-mask/",children:"ACL Mask Value in Linux"})]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Ref: ",(0,r.jsx)(n.code,{children:"man setfacl"})]}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Masks are the highest permission allowed for user / group"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"setfacl"})," auto create mask entry (union all ACL entries) by default, unless option ",(0,r.jsx)(n.code,{children:"-n"})," is set"]}),"\n",(0,r.jsxs)(n.li,{children:["Masks only apply to extended ACL (",(0,r.jsx)(n.code,{children:"setfacl"}),"), not apply to minimal ACL"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:'title="pseudo code"',children:"function effective_permission(mask, acl_entry) {\n    return mask & acl_entry;\n}\n\nfunction is_granted(user, operation, file_acl) {\n  return \n    operation & \n    effective_permission(\n      file_acl.mask,\n      matched_entry(user, file_acl)\n    )\n    > 0;\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},59622:(e,n,s)=>{s.d(n,{Z:()=>r});const r=s.p+"assets/files/acl-124eb5c6ae9f61e3187d34d8d7804702.pdf"},26192:(e,n,s)=>{s.d(n,{Z:()=>c,a:()=>d});var r=s(97049);const i={},l=r.createContext(i);function d(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);