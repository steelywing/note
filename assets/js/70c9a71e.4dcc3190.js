"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[9794],{51436:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>o});var a=s(75366),c=s(26192);const t={},r="Async / Task",i={id:"Programming/C-Sharp/Async",title:"Async / Task",description:"- Call async method will return a Task / Task, `` is return value type",source:"@site/docs/Programming/C-Sharp/Async.md",sourceDirName:"Programming/C-Sharp",slug:"/Programming/C-Sharp/Async",permalink:"/note/Programming/C-Sharp/Async",draft:!1,unlisted:!1,editUrl:"https://github.com/steelywing/note/edit/master/docs/Programming/C-Sharp/Async.md",tags:[],version:"current",frontMatter:{},sidebar:"programming",previous:{title:"Basic",permalink:"/note/Programming/C-Sharp/"},next:{title:"DLL",permalink:"/note/Programming/C-Sharp/DLL"}},l={},o=[{value:"Run sync method in <code>async</code>",id:"run-sync-method-in-async",level:2},{value:"Task",id:"task",level:2},{value:"Cancellation Token",id:"cancellation-token",level:2},{value:"Cancel after a time",id:"cancel-after-a-time",level:3}];function d(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",pre:"pre",ul:"ul",...(0,c.a)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.h1,{id:"async--task",children:"Async / Task"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:["Call ",(0,a.jsx)(e.code,{children:"async"})," method will return a ",(0,a.jsx)(e.code,{children:"Task"})," / ",(0,a.jsx)(e.code,{children:"Task<T>"}),", ",(0,a.jsx)(e.code,{children:"<T>"})," is return value type","\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.code,{children:"Task"})," == JavaScript ",(0,a.jsx)(e.code,{children:"Promise"})]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(e.li,{children:["C# ",(0,a.jsx)(e.code,{children:"async"})," method must include ",(0,a.jsx)(e.code,{children:"await"}),", otherwise will run sync"]}),"\n",(0,a.jsxs)(e.li,{children:["Use ",(0,a.jsx)(e.code,{children:"Task.Delay(<ms>)"})," to create a delay task"]}),"\n",(0,a.jsxs)(e.li,{children:["Call ",(0,a.jsx)(e.code,{children:"await <Task>"})," to wait the ",(0,a.jsx)(e.code,{children:"Task"})," return result"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.code,{children:"Task.CurrentId"})," == Current task ID"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.code,{children:"Task.Run()"})," will create new thread"]}),"\n",(0,a.jsxs)(e.li,{children:["Call ",(0,a.jsx)(e.code,{children:"async"})," method does not create new thread (like ",(0,a.jsx)(e.code,{children:"yield"}),")"]}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-cs",children:'async static Task<int> AddAsync(int x, int y)\n{\n    Console.WriteLine("Task Start");\n    await Task.Delay(3000);\n    Console.WriteLine("Task End");\n    return x + y;\n}\n\nvar task = AddAsync(1, 2);\nThread.Sleep(1000);\nConsole.WriteLine("Main");\nConsole.WriteLine("Result = " + await task);\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"Task Start\n# ~ 1000ms\nMain\n# ~ 2000ms\nTask End\nResult = 3\n"})}),"\n",(0,a.jsxs)(e.h2,{id:"run-sync-method-in-async",children:["Run sync method in ",(0,a.jsx)(e.code,{children:"async"})]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-cs",children:'int x = 1;\n// Task.Factory.StartNew(...);\n// same as\nvar task = Task.Run(() =>\n{\n    Console.WriteLine("Start");\n    Thread.Sleep(2000);\n    Console.WriteLine("End");\n    return x * 2;\n});\n\nThread.Sleep(1000);\nConsole.WriteLine("Waiting Task");\nConsole.WriteLine(await task);\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"Start\n# ~ 1000ms\nWaiting Task\n# ~ 1000ms\nEnd\nResult\n"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.code,{children:"Task.Run()"})," can have return value"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.code,{children:"Task.Run()"})," ",(0,a.jsx)(e.code,{children:"Func"})," can not have parameter"]}),"\n"]}),"\n",(0,a.jsx)(e.h2,{id:"task",children:"Task"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-cs",children:'// Create a task but do not start it\nvar task = new Task(() => "Task");\n\n// Start task\ntask.Start();\n\n// Wait the task finish\ntask.Wait();\n\n// Wait the task 1000ms, return true if finish\nvar finished = task.Wait(1000);\n'})}),"\n",(0,a.jsx)(e.h2,{id:"cancellation-token",children:"Cancellation Token"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.code,{children:"CancellationToken"})," is like a ",(0,a.jsx)(e.code,{children:"bool"}),", let ",(0,a.jsx)(e.code,{children:"asyn"})," method to know if cancellation requested"]}),"\n",(0,a.jsxs)(e.li,{children:["Cancellation request need to be set using ",(0,a.jsx)(e.code,{children:"CancellationTokenSource.Cancel()"}),", ",(0,a.jsx)(e.code,{children:"CancellationToken"})," cannot request cancellation"]}),"\n",(0,a.jsxs)(e.li,{children:["Most of C# ",(0,a.jsx)(e.code,{children:"async"})," method support"]}),"\n",(0,a.jsxs)(e.li,{children:["You need handle ",(0,a.jsx)(e.code,{children:"CancellationToken"})," by yourself in your method"]}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-cs",children:'async static Task LoopAsync(int seconds, CancellationToken ct)\n{\n    for (int i = 0; i < seconds; i += 1)\n    {\n        if (ct.IsCancellationRequested)\n            break;\n        Console.WriteLine($"Loop {i}");\n        await Task.Delay(1000, ct);\n    }\n}\n\nvar cts = new CancellationTokenSource();\n\n// Loop 100 seconds\nvar task = LoopAsync(100, cts.Token);\n\nThread.Sleep(10 * 1000);\n// Cancel after 10 seconds\ncts.Cancel();\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"Loop 0\nLoop 1\nLoop 2\nLoop 3\nLoop 4\nLoop 5\nLoop 6\nLoop 7\nLoop 8\nLoop 9\n"})}),"\n",(0,a.jsx)(e.h3,{id:"cancel-after-a-time",children:"Cancel after a time"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-cs",children:"var cts = new CancellationTokenSource();\ncts.\n"})})]})}function h(n={}){const{wrapper:e}={...(0,c.a)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(d,{...n})}):d(n)}},26192:(n,e,s)=>{s.d(e,{Z:()=>i,a:()=>r});var a=s(97049);const c={},t=a.createContext(c);function r(n){const e=a.useContext(t);return a.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(c):n.components||c:r(n.components),a.createElement(t.Provider,{value:e},n.children)}}}]);