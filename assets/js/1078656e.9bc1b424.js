"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[4003],{99870:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>a});var t=s(75366),l=s(26192);const r={},i="SELinux",c={id:"Linux/SELinux",title:"SELinux",description:"Video Guide: Security-Enhanced Linux for mere mortals",source:"@site/docs/Linux/SELinux.md",sourceDirName:"Linux",slug:"/Linux/SELinux",permalink:"/note/Linux/SELinux",draft:!1,unlisted:!1,editUrl:"https://github.com/steelywing/note/edit/master/docs/Linux/SELinux.md",tags:[],version:"current",frontMatter:{},sidebar:"linux",previous:{title:"Reset root password",permalink:"/note/Linux/Reset Password"},next:{title:"SSH tunnel",permalink:"/note/Linux/SSH-Tunnel"}},d={},a=[{value:"Get SELinux status",id:"get-selinux-status",level:2},{value:"Set SELinux status",id:"set-selinux-status",level:2},{value:"View SELinux label",id:"view-selinux-label",level:2},{value:"Troubleshoot",id:"troubleshoot",level:2},{value:"View SELinux error and suggestion",id:"view-selinux-error-and-suggestion",level:3},{value:"Set context to default",id:"set-context-to-default",level:3},{value:"Add default context of a path",id:"add-default-context-of-a-path",level:3},{value:"Change context by reference",id:"change-context-by-reference",level:3},{value:"Create policy module for an app",id:"create-policy-module-for-an-app",level:3},{value:"Re-label the entire file system",id:"re-label-the-entire-file-system",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"selinux",children:"SELinux"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Video Guide: ",(0,t.jsx)(n.a,{href:"https://youtu.be/_WOKRaM-HI4",children:"Security-Enhanced Linux for mere mortals"})]}),"\n"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"RedHat use SELinux by default"}),"\n",(0,t.jsx)(n.li,{children:"Debian / Ubuntu use AppArmor by default"}),"\n"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"-"}),(0,t.jsx)(n.th,{children:"-"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Enforcing"}),(0,t.jsx)(n.td,{children:"apply policy"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Permissive"}),(0,t.jsx)(n.td,{children:"log but do not apply policy"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"get-selinux-status",children:"Get SELinux status"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"getenforce\n"})}),"\n",(0,t.jsx)(n.p,{children:"Status detail"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sestatus [-v]\n"})}),"\n",(0,t.jsx)(n.h2,{id:"set-selinux-status",children:"Set SELinux status"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"setenforce { Enforcing | Permissive | 1 | 0 }\n"})}),"\n",(0,t.jsx)(n.h2,{id:"view-selinux-label",children:"View SELinux label"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"ls -Z\nid -Z\nps -Z\nss -Z\nnetstat -Z\n"})}),"\n",(0,t.jsx)(n.h2,{id:"troubleshoot",children:"Troubleshoot"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"yum install setroubleshoot setroubleshoot-server\nservice auditd restart\n\n# systemctl cannot restart, see https://bugzilla.redhat.com/show_bug.cgi?id=1026648\n# systemctl restart auditd.service\n"})}),"\n",(0,t.jsx)(n.h3,{id:"view-selinux-error-and-suggestion",children:"View SELinux error and suggestion"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"journalctl\n"})}),"\n",(0,t.jsx)(n.h3,{id:"set-context-to-default",children:"Set context to default"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["moved (",(0,t.jsx)(n.code,{children:"mv"}),") file will not change context"]}),"\n",(0,t.jsxs)(n.li,{children:["SELinux use config file ",(0,t.jsx)(n.code,{children:"/etc/selinux/targeted/contexts/files/file_contexts"})," to set default context"]}),"\n"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{}),(0,t.jsx)(n.th,{})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"-r"})," | ",(0,t.jsx)(n.code,{children:"-R"})]}),(0,t.jsx)(n.td,{children:"recursive"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"-v"})}),(0,t.jsx)(n.td,{children:"verbose, show changes in file labels"})]})]})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"restorecon [<options>] <path>\n"})}),"\n",(0,t.jsx)(n.h3,{id:"add-default-context-of-a-path",children:"Add default context of a path"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"semanage fcontext -a -t <context type> <path RegExp>\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Set ",(0,t.jsx)(n.code,{children:"/web"})," default context to ",(0,t.jsx)(n.code,{children:"httpd_sys_content_t"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'semanage fcontext -a -t httpd_sys_content_t "/web(/.*)?"\nrestorecon -v -R /web\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Set default context of ",(0,t.jsx)(n.code,{children:"/web"})," by reference"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["SELinux will replace ",(0,t.jsx)(n.code,{children:"/web"})," by ",(0,t.jsx)(n.code,{children:"/var/www/html"})," when set default context"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"semanage fcontext -a -e /var/www/html /web\nrestorecon -v -R /web\n"})}),"\n",(0,t.jsx)(n.h3,{id:"change-context-by-reference",children:"Change context by reference"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"chcon --reference <reference path> <path>\n"})}),"\n",(0,t.jsx)(n.h3,{id:"create-policy-module-for-an-app",children:"Create policy module for an app"}),"\n",(0,t.jsxs)(n.p,{children:["Set mode to ",(0,t.jsx)(n.code,{children:"Permissive"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"setenforce 0\n"})}),"\n",(0,t.jsx)(n.p,{children:"Run the app"}),"\n",(0,t.jsx)(n.p,{children:"Check the log"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"journalctl\n"})}),"\n",(0,t.jsx)(n.p,{children:"Follow the suggestion"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"grep <app> /var/log/audit/audit.log | audit2allow -M <app>\nsemodule -i <app>.pp\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Set mode to ",(0,t.jsx)(n.code,{children:"Enforcing"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"setenforce 1\n"})}),"\n",(0,t.jsx)(n.h2,{id:"re-label-the-entire-file-system",children:"Re-label the entire file system"}),"\n",(0,t.jsxs)(n.p,{children:["Set mode to ",(0,t.jsx)(n.code,{children:"Permissive"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"setenforce 0\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Create a empty file ",(0,t.jsx)(n.code,{children:".autorelabel"})," in the root directory"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"touch /.autorelabel\n"})}),"\n",(0,t.jsx)(n.p,{children:"Reboot"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"reboot\n"})})]})}function h(e={}){const{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},26192:(e,n,s)=>{s.d(n,{Z:()=>c,a:()=>i});var t=s(97049);const l={},r=t.createContext(l);function i(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);