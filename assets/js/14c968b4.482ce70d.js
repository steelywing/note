(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[1315],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return p},kt:function(){return d}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),o=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=o(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),m=o(n),d=r,k=m["".concat(s,".").concat(d)]||m[d]||u[d]||i;return n?a.createElement(k,l(l({ref:t},p),{},{components:n})):a.createElement(k,l({ref:t},p))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=m;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:r,l[1]=c;for(var o=2;o<i;o++)l[o]=n[o];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5160:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return c},contentTitle:function(){return s},metadata:function(){return o},toc:function(){return p},default:function(){return m}});var a=n(2122),r=n(9756),i=(n(7294),n(3905)),l=["components"],c={},s=void 0,o={unversionedId:"Note/OpenSSL",id:"Note/OpenSSL",isDocsHomePage:!1,title:"OpenSSL",description:"File format",source:"@site/docs/Note/OpenSSL.md",sourceDirName:"Note",slug:"/Note/OpenSSL",permalink:"/note/Note/OpenSSL",editUrl:"https://github.com/steelywing/note/edit/master/docs/Note/OpenSSL.md",version:"current",frontMatter:{},sidebar:"note",previous:{title:"Change Office VBA display language",permalink:"/note/Note/Office/README"},next:{title:"RFID",permalink:"/note/Note/RFID"}},p=[{value:"File format",id:"file-format",children:[{value:"PEM (Privacy-Enhanced Mail)",id:"pem-privacy-enhanced-mail",children:[]},{value:"PKCS #12 (<code>.p12</code>)",id:"pkcs-12-p12",children:[]},{value:"Convert <code>.pem</code> to <code>.p12</code>",id:"convert-pem-to-p12",children:[]}]},{value:"Certificate signature",id:"certificate-signature",children:[]},{value:"Option",id:"option",children:[]},{value:"Version",id:"version",children:[]},{value:"RSA key",id:"rsa-key",children:[]},{value:"CSR (Certificate Signing Request)",id:"csr-certificate-signing-request",children:[]},{value:"X509 (TLS/SSL certificate)",id:"x509-tlsssl-certificate",children:[]},{value:"Full chain certificate",id:"full-chain-certificate",children:[]},{value:"Test SSL/TLS connection",id:"test-ssltls-connection",children:[]},{value:"Test SMTP StartTLS",id:"test-smtp-starttls",children:[]},{value:"CA (Certificate Authority)",id:"ca-certificate-authority",children:[{value:"CA sign certificate",id:"ca-sign-certificate",children:[]}]},{value:"Revoke signed certificate",id:"revoke-signed-certificate",children:[{value:"CRL (Certificate Revocation List)",id:"crl-certificate-revocation-list",children:[]}]},{value:"Env",id:"env",children:[]}],u={toc:p};function m(e){var t=e.components,n=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"file-format"},"File format"),(0,i.kt)("h3",{id:"pem-privacy-enhanced-mail"},"PEM (Privacy-Enhanced Mail)"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc1421"},"RFC 1421")),(0,i.kt)("p",null,"Use to store"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"X509 certificate (",(0,i.kt)("inlineCode",{parentName:"li"},".crt")," ",(0,i.kt)("inlineCode",{parentName:"li"},".pem"),")"),(0,i.kt)("li",{parentName:"ul"},"Public / private key (",(0,i.kt)("inlineCode",{parentName:"li"},".key")," ",(0,i.kt)("inlineCode",{parentName:"li"},".pem"),")"),(0,i.kt)("li",{parentName:"ul"},"Certificate signing request (",(0,i.kt)("inlineCode",{parentName:"li"},".csr")," ",(0,i.kt)("inlineCode",{parentName:"li"},".pem"),")")),(0,i.kt)("h3",{id:"pkcs-12-p12"},"PKCS #12 (",(0,i.kt)("inlineCode",{parentName:"h3"},".p12"),")"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc7292"},"RFC 7292")),(0,i.kt)("p",null,"Bundle X509 full chain certificate, private key"),(0,i.kt)("h3",{id:"convert-pem-to-p12"},"Convert ",(0,i.kt)("inlineCode",{parentName:"h3"},".pem")," to ",(0,i.kt)("inlineCode",{parentName:"h3"},".p12")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("a",{parentName:"p",href:"https://www.openssl.org/docs/manmaster/man1/openssl-pkcs12.html"},"Reference"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'openssl pkcs12 -export\n  -in <cert.{crt|pem}>\n  [-certfile <ca.crt>]\n  -inkey <private-key.pem>\n  -out <file.p12>\n  [-passout "pass:<password>"]\n  [-name "<name>"]\n')),(0,i.kt)("h2",{id:"certificate-signature"},"Certificate signature"),(0,i.kt)("p",null,"Certificate content"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Owner DN"),(0,i.kt)("li",{parentName:"ul"},"Owner public key"),(0,i.kt)("li",{parentName:"ul"},"CA DN"),(0,i.kt)("li",{parentName:"ul"},"CA signature (Append after signed)"),(0,i.kt)("li",{parentName:"ul"},"Certificate extensions")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"// Pseudo code\n// Content is excluded signature\nCASignature = encrypt(hash(Content), CAPrivateKey)\n")),(0,i.kt)("p",null,"Verify signature"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"// Pseudo code\n// Content is excluded signature\ndecrypt(CASignature, CAPublicKey) == hash(Content)\n")),(0,i.kt)("h2",{id:"option"},"Option"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Option"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"-noout")),(0,i.kt)("td",{parentName:"tr",align:null},"Prevents output encoded data")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"-text")),(0,i.kt)("td",{parentName:"tr",align:null},"Print the data in text form")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"-modulus")),(0,i.kt)("td",{parentName:"tr",align:null},"Print the modulus of public key")))),(0,i.kt)("h2",{id:"version"},"Version"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"openssl version\n")),(0,i.kt)("h2",{id:"rsa-key"},"RSA key"),(0,i.kt)("p",null,"Generating RSA key"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# Default key lenght = 2048\nopenssl genrsa [-out <file.key>] [<key length>]\n")),(0,i.kt)("p",null,"View RSA key file"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"openssl rsa -in <file.key> -text -noout\n")),(0,i.kt)("p",null,"Extracting RSA public key"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"openssl rsa -in <file.key> -pubout -out <public.key>\n")),(0,i.kt)("h2",{id:"csr-certificate-signing-request"},"CSR (Certificate Signing Request)"),(0,i.kt)("blockquote",null,(0,i.kt)("ul",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.digicert.com/ssl-support/openssl-quick-reference-guide.htm"},"Reference")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.openssl.org/docs/manmaster/man1/openssl-req.html"},"openssl req")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://tools.ietf.org/html/rfc2986"},"RFC 2986")))),(0,i.kt)("p",null,"Creating CSR"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"openssl req \\\n  -x509 \\\n  -new \\\n  # The new created private key\n  -keyout <key.pem>\n  -days <days>\n  -out <cert.{crt|pem}>\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'openssl req -new \n  {\n    # Create new private key, bits = 2048 / 4096\n    -newkey rsa[:<bits>]\n      # Don\'t encrypt private key (no password)\n      [-nodes]\n      # The new created private key\n      [-keyout <key.pem>] |\n    # Use specified private key\n    -key <key.pem>\n  }\n  [\n    # Output a CRT (certificate) instead of CSR\n    -x509\n    # See X509\n    [<X509 options>]\n    [-set_serial <number>]\n    [-days <days>]\n    [...]\n  ]\n  -out <request.csr>\n  # <subject> = "/C=<country>/ST=<state>/L=<city>/O=<organization>/OU=<section>/CN=<domain>/emailAddress=<email>"\n  [-subj <subject>]\n  [-config <config.ini>]\n')),(0,i.kt)("p",null,"CSR configuration file ",(0,i.kt)("inlineCode",{parentName:"p"},".ini")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ini"},"[ req ]\n# <key length> = 2048 / 4096 / ...\ndefault_bits = <key length>\ndefault_keyfile = <key file>\ndistinguished_name = req_distinguished_name\nprompt = no\nencrypt_key = no\nreq_extensions = req_ext\n\n[ req_distinguished_name ]\n\n# C=\n# <country> = US | HK | TW | ...\n# ISO 3166-1 alpha-2\n# two-letter country codes\ncountryName = <country>\n\n# ST=\nstateOrProvinceName = <state>\n\n# L=\nlocalityName = <city>\n\n# O=\norganizationName = <company>\n# Multiple organization\n# 1.organizationName = <company>\n# 2.organizationName = <company>\n\n# OU=\norganizationalUnitName = <section / department>\n\n# CN=\n# For wildcard: *.example.com\ncommonName = <domain>\n\nemailAddress = <email>\n\n[ req_ext ]\n# Reference: https://www.openssl.org/docs/man1.1.1/man5/x509v3_config.html#Subject-Alternative-Name\n\n# subjectAltName=DNS:<domain>,DNS:<domain>...\n\n# same as\n\nsubjectAltName = @alt_section\n\n[ alt_section ]\nDNS.1 = <domain>\nDNS.2 = <domain>\n# ...\n")),(0,i.kt)("p",null,"Verify CSR signature"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"openssl req -text -in <file.csr> -noout -verify\n")),(0,i.kt)("h2",{id:"x509-tlsssl-certificate"},"X509 (TLS/SSL certificate)"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("a",{parentName:"p",href:"https://www.openssl.org/docs/man1.1.1/man1/x509.html"},"Reference"))),(0,i.kt)("p",null,"Certificate display and signing"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"#csr-certificate-signing-request"},"Self signed certificate with new key")),(0,i.kt)("p",null,"Self signed certificate using existing key"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"openssl x509 \n    # By default input is CRT (certificate)\n    # Use CSR as input\n    -req\n    -in <request.csr> \n    -days <days>\n    # Private key use for signing\n    -signkey <key.pem> \n    -out <cert.{crt|pem}> \n")),(0,i.kt)("p",null,"CA (Certificate Authority) sign certificate"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"openssl x509 \n    -req \n    -in <request.csr> \n    -days <days> \n    -CA <ca.crt> \n    # CA private key\n    -CAkey <ca.key> \n    {\n      # Create new serial number file\n      -CAcreateserial |\n      # Specify serial number file, `$(basename <ca.crt> .crt).srl` by default\n      -CAserial <filename> |\n      # Specify serial number, Decimal 01 02..., Hex 0x1 0x2...\n      -set_serial <serial>\n    } \n    -out <cert.{crt|pem}>\n")),(0,i.kt)("p",null,"Display the contents of certificate (",(0,i.kt)("inlineCode",{parentName:"p"},".crt"),")"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"openssl x509 -in <cert.{crt|pem}> -text -noout\n")),(0,i.kt)("p",null,"Verify if a private key matches a certificate"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("a",{parentName:"p",href:"https://www.ibm.com/support/pages/how-verify-if-private-key-matches-certificate"},"Reference"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"openssl x509 -noout -modulus -in <cert.crt> | openssl md5\nopenssl rsa -noout -modulus -in <private-key.pem> | openssl md5\nopenssl req -noout -modulus -in <csr.pem> | openssl md5\n")),(0,i.kt)("h2",{id:"full-chain-certificate"},"Full chain certificate"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"CA = Chain")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"cat <cert.crt> <chain.crt> > <fullchain.crt>\n")),(0,i.kt)("h2",{id:"test-ssltls-connection"},"Test SSL/TLS connection"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"openssl s_client -connect <host>:<port>\n")),(0,i.kt)("h2",{id:"test-smtp-starttls"},"Test SMTP StartTLS"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"openssl s_client -starttls smtp -showcerts -connect <host>:<port> -servername <domain>\n")),(0,i.kt)("h2",{id:"ca-certificate-authority"},"CA (Certificate Authority)"),(0,i.kt)("blockquote",null,(0,i.kt)("ul",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.openssl.org/docs/manmaster/man1/openssl-ca.html"},"Reference")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.openssl.org/docs/manmaster/man5/x509v3_config.html"},"X509 V3")))),(0,i.kt)("p",null,"Config"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-properties"},"[ ca ]\ndefault_ca      = CA_default\n\n[ CA_default ]\n\ndir             = .\ndatabase        = $dir/database.txt\nnew_certs_dir   = $dir/new_certs\nunique_subject  = no\n\ncertificate     = $dir/ca.crt\nserial          = $dir/ca.srl\n# rand_serial     = yes\nprivate_key     = $dir/private/ca.key\nRANDFILE        = $dir/private/.rand\n\ndefault_days    = 365000\ndefault_crl_days= 365000\ndefault_md      = sha256\n\npolicy          = policy_any\nemail_in_dn     = no\n\n# Subject name display option\nname_opt        = ca_default\n# Certificate display option\ncert_opt        = ca_default\ncopy_extensions = copy\n\nx509_extensions = extensions\ncrl_extensions  = crl_exts\n\n[ policy_any ]\ncountryName             = optional\nstateOrProvinceName     = optional\nlocalityName            = optional\norganizationName        = supplied\norganizationalUnitName  = optional\ncommonName              = supplied\nemailAddress            = optional\n\n[ extensions ]\n# CA certificate\n# basicConstraints        = critical, CA:TRUE\n# basicConstraints        = critical, CA:TRUE, pathlen:1\n\n# End-user certificate\nbasicConstraints        = CA:FALSE\n\nsubjectKeyIdentifier    = hash\nauthorityKeyIdentifier  = keyid:always, issuer:always\nissuerAltName           = issuer:copy\ncrlDistributionPoints   = URI:http://example.com/ca.crl\n\n[ crl_exts ]\nauthorityKeyIdentifier = keyid:always,issuer:always\n")),(0,i.kt)("h3",{id:"ca-sign-certificate"},"CA sign certificate"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"openssl ca\n  [-batch] # No prompt\n  [-config <ca.conf>]\n  -in <request.csr>\n  -out <cert.{crt|pem}>\n")),(0,i.kt)("h2",{id:"revoke-signed-certificate"},"Revoke signed certificate"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"openssl ca\n  [-config <ca.conf>]\n  -revoke <cert.{crt|pem}>\n")),(0,i.kt)("h3",{id:"crl-certificate-revocation-list"},"CRL (Certificate Revocation List)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"openssl ca -gencrl\n  [-config <ca.conf>]\n  -out <revoked.crl>\n")),(0,i.kt)("h2",{id:"env"},"Env"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"OPENSSL_CONF=<openssl.cnf>\n")),(0,i.kt)("p",null,"Same as"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"openssl ... -config <openssl.cnf>\n")))}m.isMDXComponent=!0}}]);