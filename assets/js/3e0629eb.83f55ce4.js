"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[780],{86308:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>d,frontMatter:()=>s,metadata:()=>a,toc:()=>l});var o=t(75366),r=t(26192);const s={tags:["Nginx","Proxy","WebSocket"]},c="WebSocket Proxy - Nginx",a={id:"Note/Nginx/WebSocket",title:"WebSocket Proxy - Nginx",description:"Proxy ws//localhost:7890/",source:"@site/docs/Note/Nginx/WebSocket.md",sourceDirName:"Note/Nginx",slug:"/Note/Nginx/WebSocket",permalink:"/note/Note/Nginx/WebSocket",draft:!1,unlisted:!1,editUrl:"https://github.com/steelywing/note/edit/master/docs/Note/Nginx/WebSocket.md",tags:[{label:"Nginx",permalink:"/note/tags/nginx"},{label:"Proxy",permalink:"/note/tags/proxy"},{label:"WebSocket",permalink:"/note/tags/web-socket"}],version:"current",frontMatter:{tags:["Nginx","Proxy","WebSocket"]},sidebar:"note",previous:{title:"Variable",permalink:"/note/Note/Nginx/Variable"},next:{title:"error_page",permalink:"/note/Note/Nginx/error_page"}},i={},l=[];function p(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"websocket-proxy---nginx",children:"WebSocket Proxy - Nginx"}),"\n",(0,o.jsxs)(n.p,{children:["Proxy ",(0,o.jsx)(n.code,{children:"ws://example.com/ws/"})," to ",(0,o.jsx)(n.code,{children:"ws://localhost:7890/"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-nginx",children:"map $http_upgrade $connection_upgrade {\n    default upgrade;\n    ''      close;\n}\n\nserver {\n    listen 80;\n    server_name example.com;\n\n    # ...\n\n    location /ws/ {\n        proxy_pass http://localhost:7890/;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection $connection_upgrade;\n        proxy_set_header Host $host;\n    }\n}\n"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Ref: ",(0,o.jsx)(n.a,{href:"https://www.nginx.com/blog/websocket-nginx/",children:"Nginx WebSocket"})]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Proxy all WebSocket request to ",(0,o.jsx)(n.code,{children:"ws://localhost:7890/"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-nginx",children:'map $http_upgrade $connection_upgrade {\n    default upgrade;\n    \'\'      close;\n}\n\nserver {\n    listen 80;\n    server_name example.com;\n\n    location /websocket/ {\n        internal;\n\n        proxy_pass http://localhost:7890/;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection $connection_upgrade;\n    }\n\n    location / {\n        set $websocket 1;\n        if ($http_connection !~* "upgrade") {\n            set $websocket 0;\n        }\n        if ($http_upgrade !~* "websocket") {\n            set $websocket 0;\n        }\n        if ($websocket) {\n            rewrite ^ /websocket$uri last;\n        }\n\n        # ...\n    }\n}\n'})})]})}function d(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(p,{...e})}):p(e)}},26192:(e,n,t)=>{t.d(n,{Z:()=>a,a:()=>c});var o=t(97049);const r={},s=o.createContext(r);function c(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);