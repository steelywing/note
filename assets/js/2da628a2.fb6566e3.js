"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[173],{15703:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var s=t(75366),r=t(26192);const i={},o="TLS SNI",a={id:"Note/Nginx/SNI",title:"TLS SNI",description:"TLS Server Name Indication",source:"@site/docs/Note/Nginx/SNI.md",sourceDirName:"Note/Nginx",slug:"/Note/Nginx/SNI",permalink:"/note/Note/Nginx/SNI",draft:!1,unlisted:!1,editUrl:"https://github.com/steelywing/note/edit/master/docs/Note/Nginx/SNI.md",tags:[],version:"current",frontMatter:{},sidebar:"note",previous:{title:"Redirect / Rewrite",permalink:"/note/Note/Nginx/Rewrite"},next:{title:"SSL / TLS",permalink:"/note/Note/Nginx/SSL"}},l={},c=[{value:"Check SNI support",id:"check-sni-support",level:2},{value:"Testing",id:"testing",level:2}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"tls-sni",children:"TLS SNI"}),"\n",(0,s.jsx)(n.p,{children:"TLS Server Name Indication"}),"\n",(0,s.jsx)(n.p,{children:"SNI allows browser to pass requested server name during the SSL handshake"}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["To support multiple SSL ",(0,s.jsx)(n.code,{children:"server_name"})," ",(0,s.jsx)(n.code,{children:"server"})," section, Nginx version must support SNI"]})}),"\n",(0,s.jsx)(n.h2,{id:"check-sni-support",children:"Check SNI support"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"http://nginx.org/en/docs/http/configuring_https_servers.html",children:"Ref"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ nginx -V\n...\nTLS SNI support enabled\n...\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Check the ",(0,s.jsx)(n.code,{children:"error_log"})," that without"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"nginx was built with SNI support, however, now it is linked\ndynamically to an OpenSSL library which has no tlsext support,\ntherefore SNI is not available\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"If Nginx does not support TLS SNI, Nginx will use default server certificate for all request"})}),"\n",(0,s.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,s.jsx)(n.p,{children:"Create self signed certificate"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'openssl req -x509 -newkey rsa -nodes -keyout default.key -days 36500 -out default.crt -subj "/CN=example.org"\n\nopenssl req -x509 -newkey rsa -nodes -keyout a.key -days 36500 -out a.crt -subj "/CN=a.example.org"\n\nopenssl req -x509 -newkey rsa -nodes -keyout b.key -days 36500 -out b.crt -subj "/CN=b.example.org"\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'server {\n    listen       443 ssl default_server;\n    server_name  "";\n\n    ssl_certificate      default.crt;\n    ssl_certificate_key  default.key;\n\n    default_type text/plain;\n    return 200 "default page";\n}\n\nserver {\n    listen       443 ssl;\n    server_name  a.example.org;\n\n    ssl_certificate      a.crt;\n    ssl_certificate_key  a.key;\n\n    default_type text/plain;\n    return 200 "a.example.org page";\n}\n\nserver {\n    listen       443 ssl;\n    server_name  b.example.org;\n\n    ssl_certificate      b.crt;\n    ssl_certificate_key  b.key;\n\n    default_type text/plain;\n    return 200 "b.example.org page";\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Test SNI"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Use -v to see the certificate\n\n$ curl --insecure --resolve "a.example.org:443:127.0.0.1" https://a.example.org\n\na.example.org page\n\n$ curl --insecure --resolve "b.example.org:443:127.0.0.1" https://b.example.org\n\nb.example.org page\n\n$ curl --insecure https://127.0.0.1\n\ndefault page\n'})})]})}function p(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},26192:(e,n,t)=>{t.d(n,{Z:()=>a,a:()=>o});var s=t(97049);const r={},i=s.createContext(r);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);