(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[2120],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return s},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var o=r.createContext({}),u=function(e){var t=r.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},s=function(e){var t=u(e.components);return r.createElement(o.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,s=p(e,["components","mdxType","originalType","parentName"]),c=u(n),m=a,k=c["".concat(o,".").concat(m)]||c[m]||d[m]||i;return n?r.createElement(k,l(l({ref:t},s),{},{components:n})):r.createElement(k,l({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,l=new Array(i);l[0]=c;var p={};for(var o in t)hasOwnProperty.call(t,o)&&(p[o]=t[o]);p.originalType=e,p.mdxType="string"==typeof e?e:a,l[1]=p;for(var u=2;u<i;u++)l[u]=n[u];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},3912:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return p},contentTitle:function(){return o},metadata:function(){return u},toc:function(){return s},default:function(){return c}});var r=n(2122),a=n(9756),i=(n(7294),n(3905)),l=["components"],p={},o="iptables",u={unversionedId:"Linux/iptables",id:"Linux/iptables",isDocsHomePage:!1,title:"iptables",description:"Reference",source:"@site/docs/Linux/iptables.md",sourceDirName:"Linux",slug:"/Linux/iptables",permalink:"/note/Linux/iptables",editUrl:"https://github.com/steelywing/note/edit/master/docs/Linux/iptables.md",version:"current",frontMatter:{},sidebar:"linux",previous:{title:"awk",permalink:"/note/Linux/awk"},next:{title:"sed",permalink:"/note/Linux/sed"}},s=[{value:"Flow",id:"flow",children:[]},{value:"Policy",id:"policy",children:[]},{value:"Rule",id:"rule",children:[]},{value:"Extension",id:"extension",children:[]},{value:"Redirect input to other port",id:"redirect-input-to-other-port",children:[]},{value:"Masquerading (Source NAT)",id:"masquerading-source-nat",children:[]}],d={toc:s};function c(e){var t=e.components,p=(0,a.Z)(e,l);return(0,i.kt)("wrapper",(0,r.Z)({},d,p,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"iptables"},"iptables"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://wiki.archlinux.org/index.php/iptables"},"Reference")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Description"),(0,i.kt)("th",{parentName:"tr",align:null},"Command"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Verbose list rules"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"iptables -v -L [<chain>]"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"List rules"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"iptables -S [<chain>]"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Dump iptables to file"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"iptables-save > <file>"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Restore iptables from file"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"iptables-restore < <file>"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Save iptables (Red Hat <= 6)"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"service iptables save"))))),(0,i.kt)("h2",{id:"flow"},"Flow"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null}),(0,i.kt)("th",{parentName:"tr",align:null}))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Chains"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"INPUT")," / ",(0,i.kt)("inlineCode",{parentName:"td"},"OUTPUT")," / ",(0,i.kt)("inlineCode",{parentName:"td"},"FORWARD")," / ",(0,i.kt)("inlineCode",{parentName:"td"},"PREROUTING")," / ",(0,i.kt)("inlineCode",{parentName:"td"},"POSTROUTING"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Tables"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"raw")," / ",(0,i.kt)("inlineCode",{parentName:"td"},"filter")," / ",(0,i.kt)("inlineCode",{parentName:"td"},"nat")," / ",(0,i.kt)("inlineCode",{parentName:"td"},"mangle")," / ",(0,i.kt)("inlineCode",{parentName:"td"},"security")," (Default is ",(0,i.kt)("inlineCode",{parentName:"td"},"filter"),")")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Targets"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"ACCEPT")," / ",(0,i.kt)("inlineCode",{parentName:"td"},"DROP")," / ",(0,i.kt)("inlineCode",{parentName:"td"},"QUEUE")," / ",(0,i.kt)("inlineCode",{parentName:"td"},"RETURN")," / ",(0,i.kt)("inlineCode",{parentName:"td"},"REJECT")," / ",(0,i.kt)("inlineCode",{parentName:"td"},"LOG"))))),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://stuffphilwrites.com/2014/09/iptables-processing-flowchart/"},"Reference")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"iptables flow chart",src:n(9561).Z,title:":class=stroke"})),(0,i.kt)("h2",{id:"policy"},"Policy"),(0,i.kt)("p",null,"Policy = Default target"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -P <chain> <target>\n")),(0,i.kt)("h2",{id:"rule"},"Rule"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://www.netfilter.org/documentation/HOWTO/packet-filtering-HOWTO-7.html"},"Reference")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"iptables \n    { -A <chain> | -I <chain> [rule number] | -D <chain> [rule number] }\n    [[!] -i <interface>]\n    [[!] -o <interface>]\n    [[!] -s <src IP address>[/<prefix length>]]\n    [[!] -d <dest IP address>[/<prefix length>]]\n    [[!] -p {icmp|tcp|udp}]\n    [[!] --sport <src port>]\n    [[!] --dport <dest port>]\n    -j <target>\n")),(0,i.kt)("h2",{id:"extension"},"Extension"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"http://ipset.netfilter.org/iptables-extensions.man.html"},"Reference")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"iptables <rule>\n    [-m state [!] --state { NEW | ESTABLISHED | RELATED }]\n    [-m conntrack \n        [[!] --ctstate { INVALID | NEW | ESTABLISHED | RELATED | UNTRACKED | SNAT | DNAT }]\n    ]\n    -j <target>\n")),(0,i.kt)("h2",{id:"redirect-input-to-other-port"},"Redirect input to other port"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://www.netfilter.org/documentation/HOWTO/NAT-HOWTO-6.html"},"Reference")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -t nat -A PREROUTING [-i <interface>] -p tcp --dport <from port> -j REDIRECT --to-port <to port>\n")),(0,i.kt)("h2",{id:"masquerading-source-nat"},"Masquerading (Source NAT)"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://www.netfilter.org/documentation/HOWTO/NAT-HOWTO-6.html"},"Reference")),(0,i.kt)("p",null,"Use the address of the interface the packet is going out as source address"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -t nat -A POSTROUTING -o <interface> -j MASQUERADE\n")))}c.isMDXComponent=!0},9561:function(e,t,n){"use strict";t.Z=n.p+"assets/images/iptables-6d8e4d71be52213c9598926fdc58e976.svg"}}]);