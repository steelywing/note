"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[8040],{19436:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>r,contentTitle:()=>s,default:()=>c,frontMatter:()=>t,metadata:()=>i,toc:()=>d});var o=l(75366),a=l(26192);const t={date:new Date("2023-08-02T00:00:00.000Z"),tags:["Samba","SMB"]},s="Samba VFS full audit log all operations",i={permalink:"/note/blog/Samba VFS full audit log all operations",source:"@site/blog/Samba VFS full audit log all operations.md",title:"Samba VFS full audit log all operations",description:"Ref: man vfsfullaudit",date:"2023-08-02T00:00:00.000Z",formattedDate:"August 2, 2023",tags:[{label:"Samba",permalink:"/note/blog/tags/samba"},{label:"SMB",permalink:"/note/blog/tags/smb"}],readingTime:.83,hasTruncateMarker:!0,authors:[],frontMatter:{date:"2023-08-02T00:00:00.000Z",tags:["Samba","SMB"]},unlisted:!1,prevItem:{title:"Enable WebRender in Firefox",permalink:"/note/blog/Firefox WebRender"},nextItem:{title:"Create shortcut .lnk in CLI",permalink:"/note/blog/Create shortcut lnk in CLI"}},r={authorsImageUrls:[]},d=[{value:"Log level",id:"log-level",level:2},{value:"Find the un-supported operations",id:"find-the-un-supported-operations",level:2}];function u(e){const n={admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Ref: ",(0,o.jsx)(n.code,{children:"man vfs_full_audit"})]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Enable ",(0,o.jsx)(n.code,{children:"full_audit"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ini",children:'[global]\n# enable "full_audit"\nvfs objects = full_audit\n\n# the log message prefix, the default is "%u|%I"\n# full_audit:prefix = %u|%I\n\n# log successful "connect", "disconnect" operations\nfull_audit:success = connect disconnect\n\n# log all failure operations except "open"\nfull_audit:failure = all !open\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["VFS full audit operations are different in different version, even ",(0,o.jsx)(n.code,{children:"man vfs_full_audit"})," is not updated"]}),"\n",(0,o.jsxs)(n.li,{children:["If un-supported operation is set, ",(0,o.jsx)(n.code,{children:"all"})," is used"]}),"\n"]})}),"\n",(0,o.jsx)(n.h2,{id:"log-level",children:"Log level"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Higher log level \u25b6 More detailed log"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["To set ",(0,o.jsx)(n.code,{children:"full_audit"})," log level to 10 (debug)"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ini",children:"[global]\nlog level = full_audit:10\n# log level = full_audit:10@/var/log/samba/audit.log\n"})}),"\n",(0,o.jsxs)(n.p,{children:["To set all ",(0,o.jsx)(n.code,{children:"log level"})," to 10 (debug)"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ini",children:"[global]\nlog file = /var/log/samba/log.%m\nlog level = 10\n"})}),"\n",(0,o.jsx)(n.p,{children:"Now, access Samba from client, Samba will log the debug message"}),"\n",(0,o.jsx)(n.h2,{id:"find-the-un-supported-operations",children:"Find the un-supported operations"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:'grep -r "Could not find opname" /var/log/samba/\n'})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"/var/log/samba/log.user-pc.old:  Could not find opname chmod, logging all\n"})}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},26192:(e,n,l)=>{l.d(n,{Z:()=>i,a:()=>s});var o=l(97049);const a={},t=o.createContext(a);function s(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);